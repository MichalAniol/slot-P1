var assets = [{url:'/Content/01221b69-9685-4f0d-9862-6be704bd3cd2.weptx',path:'/Content/',name:'01221b69-9685-4f0d-9862-6be704bd3cd2.weptx',size:1620},{url:'/Content/02181b63-5a0e-46d1-9208-d92376ae33fb.wepmt',path:'/Content/',name:'02181b63-5a0e-46d1-9208-d92376ae33fb.wepmt',size:1722},{url:'/Content/0277d688-eee0-4852-afad-4e3ee5a5f76c.wepmt',path:'/Content/',name:'0277d688-eee0-4852-afad-4e3ee5a5f76c.wepmt',size:2743},{url:'/Content/07185b61-055b-44a2-b09e-917e2e8bb062.wepsp',path:'/Content/',name:'07185b61-055b-44a2-b09e-917e2e8bb062.wepsp',size:134},{url:'/Content/0a4e4207-211d-48c5-aa10-d2dd0a59497f.wepmt',path:'/Content/',name:'0a4e4207-211d-48c5-aa10-d2dd0a59497f.wepmt',size:2743},{url:'/Content/0bc3ecbf-20f2-4bb2-b2cf-8404ddba89fe.wepmd',path:'/Content/',name:'0bc3ecbf-20f2-4bb2-b2cf-8404ddba89fe.wepmd',size:68003},{url:'/Content/0db59561-b3f5-444f-b5de-e62e3a5b42bf.weprl',path:'/Content/',name:'0db59561-b3f5-444f-b5de-e62e3a5b42bf.weprl',size:409},{url:'/Content/127b9836-5d92-4352-b0cb-d2dfa62e6ada.wepsp',path:'/Content/',name:'127b9836-5d92-4352-b0cb-d2dfa62e6ada.wepsp',size:134},{url:'/Content/16f32d46-2073-4343-bf27-08d9f1edf1ce.wepmd',path:'/Content/',name:'16f32d46-2073-4343-bf27-08d9f1edf1ce.wepmd',size:60899},{url:'/Content/1b672bab-2c12-4a33-b062-5a1b5d18aace.wepmt',path:'/Content/',name:'1b672bab-2c12-4a33-b062-5a1b5d18aace.wepmt',size:436},{url:'/Content/1d499657-de58-4eb1-a051-16358bf09447.wepmt',path:'/Content/',name:'1d499657-de58-4eb1-a051-16358bf09447.wepmt',size:2743},{url:'/Content/244dbfd5-2985-4e03-bcd1-b1e8aaeb4304.wepmd',path:'/Content/',name:'244dbfd5-2985-4e03-bcd1-b1e8aaeb4304.wepmd',size:52443},{url:'/Content/287ffd15-b0aa-4ad6-98f0-ba59e71542b1.wepsp',path:'/Content/',name:'287ffd15-b0aa-4ad6-98f0-ba59e71542b1.wepsp',size:134},{url:'/Content/28a79d98-0222-4ed2-b7e2-599b641e91dd.wepmt',path:'/Content/',name:'28a79d98-0222-4ed2-b7e2-599b641e91dd.wepmt',size:2743},{url:'/Content/2c941bf9-3fe3-4495-9bfe-c2f0177c9b6b.wepmt',path:'/Content/',name:'2c941bf9-3fe3-4495-9bfe-c2f0177c9b6b.wepmt',size:2743},{url:'/Content/2ce6b4df-0393-4c7b-aee4-f07862c6cae2.wepmd',path:'/Content/',name:'2ce6b4df-0393-4c7b-aee4-f07862c6cae2.wepmd',size:36939},{url:'/Content/38f6c478-a8eb-4bb9-acc2-e548e3e15b2a.wepsp',path:'/Content/',name:'38f6c478-a8eb-4bb9-acc2-e548e3e15b2a.wepsp',size:134},{url:'/Content/3c8b7b5c-c9dc-42ac-8ebe-149ab80d098b.wepsp',path:'/Content/',name:'3c8b7b5c-c9dc-42ac-8ebe-149ab80d098b.wepsp',size:134},{url:'/Content/40644ae0-c7cf-4078-8059-5f6c83a272d0.wepmt',path:'/Content/',name:'40644ae0-c7cf-4078-8059-5f6c83a272d0.wepmt',size:2743},{url:'/Content/4679aab9-3a80-44a3-944d-c6136c3190f2.wepmd',path:'/Content/',name:'4679aab9-3a80-44a3-944d-c6136c3190f2.wepmd',size:61499},{url:'/Content/479ea082-68be-4798-9c9a-d42f9f02b5dd.wepsp',path:'/Content/',name:'479ea082-68be-4798-9c9a-d42f9f02b5dd.wepsp',size:134},{url:'/Content/524e52a9-5984-4668-9573-b59a80daf7b5.wepmd',path:'/Content/',name:'524e52a9-5984-4668-9573-b59a80daf7b5.wepmd',size:87507},{url:'/Content/5d0ed39b-6526-4c39-8de0-d00d78ba5de0.wepfx',path:'/Content/',name:'5d0ed39b-6526-4c39-8de0-d00d78ba5de0.wepfx',size:23130},{url:'/Content/5d9b7441-7fcd-4167-9dd4-05e6dce235e7.wepfx',path:'/Content/',name:'5d9b7441-7fcd-4167-9dd4-05e6dce235e7.wepfx',size:5669},{url:'/Content/5e2bd4a7-4c3f-4bf4-b487-f17e1a11f872.weptx',path:'/Content/',name:'5e2bd4a7-4c3f-4bf4-b487-f17e1a11f872.weptx',size:3080},{url:'/Content/5f43d699-ac7b-4cb4-a212-b67de57411d2.wepmt',path:'/Content/',name:'5f43d699-ac7b-4cb4-a212-b67de57411d2.wepmt',size:2743},{url:'/Content/5f795365-07f5-4b56-83df-043eb40a7457.wepmt',path:'/Content/',name:'5f795365-07f5-4b56-83df-043eb40a7457.wepmt',size:617},{url:'/Content/625460bd-2afb-49f2-8b11-e01e4f4cf682.wepmt',path:'/Content/',name:'625460bd-2afb-49f2-8b11-e01e4f4cf682.wepmt',size:2743},{url:'/Content/6254b3b0-d0f9-48f7-a088-cabcbd17c104.wepmt',path:'/Content/',name:'6254b3b0-d0f9-48f7-a088-cabcbd17c104.wepmt',size:2743},{url:'/Content/679c1d0f-4a5c-430e-9c9a-45e983c7227b.wepmt',path:'/Content/',name:'679c1d0f-4a5c-430e-9c9a-45e983c7227b.wepmt',size:2743},{url:'/Content/6f51bee0-e1b6-412c-bb2b-aefabee774e6.weprp',path:'/Content/',name:'6f51bee0-e1b6-412c-bb2b-aefabee774e6.weprp',size:549581},{url:'/Content/6f92dcc5-1bbc-4339-a0a1-9077a2bbf481.wepmd',path:'/Content/',name:'6f92dcc5-1bbc-4339-a0a1-9077a2bbf481.wepmd',size:7339070},{url:'/Content/71dcf5c9-3d80-4e72-8a2c-c168f4094a3a.wepmd',path:'/Content/',name:'71dcf5c9-3d80-4e72-8a2c-c168f4094a3a.wepmd',size:36987},{url:'/Content/7708f1ad-c349-4fc2-9a76-3459c7b98da5.wepmt',path:'/Content/',name:'7708f1ad-c349-4fc2-9a76-3459c7b98da5.wepmt',size:436},{url:'/Content/7af58425-e6cf-43b4-9719-9a57e9ea047b.wepsp',path:'/Content/',name:'7af58425-e6cf-43b4-9719-9a57e9ea047b.wepsp',size:134},{url:'/Content/7d1e2792-2031-42bb-a67c-0dbd282be12a.wepsp',path:'/Content/',name:'7d1e2792-2031-42bb-a67c-0dbd282be12a.wepsp',size:134},{url:'/Content/7e06a9e5-a2ae-438b-9c4a-85570f2cf6ef.wepsp',path:'/Content/',name:'7e06a9e5-a2ae-438b-9c4a-85570f2cf6ef.wepsp',size:134},{url:'/Content/7e946d98-37d0-489f-9a50-c2f58f53b51e.wepfx',path:'/Content/',name:'7e946d98-37d0-489f-9a50-c2f58f53b51e.wepfx',size:46988},{url:'/Content/7efb1394-cf61-4617-8dad-8dc5c7d46164.wepfx',path:'/Content/',name:'7efb1394-cf61-4617-8dad-8dc5c7d46164.wepfx',size:2519},{url:'/Content/8496ea73-d03d-4ebc-ad72-1510c7ab0c96.wepsp',path:'/Content/',name:'8496ea73-d03d-4ebc-ad72-1510c7ab0c96.wepsp',size:134},{url:'/Content/895d17ec-973e-4752-a986-894889c6cfd4.wepmt',path:'/Content/',name:'895d17ec-973e-4752-a986-894889c6cfd4.wepmt',size:436},{url:'/Content/8b1d459c-c433-4ee3-bfe5-b45fbce12736.weptx',path:'/Content/',name:'8b1d459c-c433-4ee3-bfe5-b45fbce12736.weptx',size:5592684},{url:'/Content/8e7317aa-3a55-45c6-82a5-47d333abe272.weprl',path:'/Content/',name:'8e7317aa-3a55-45c6-82a5-47d333abe272.weprl',size:409},{url:'/Content/9018edf8-ea96-4721-bf83-5561942432e0.wepsp',path:'/Content/',name:'9018edf8-ea96-4721-bf83-5561942432e0.wepsp',size:134},{url:'/Content/910dd05a-3f80-4650-ad5c-22f688c3a66f.wepfx',path:'/Content/',name:'910dd05a-3f80-4650-ad5c-22f688c3a66f.wepfx',size:4272},{url:'/Content/911f3d3b-6fc9-4bc2-984a-15c399b967bc.wepmt',path:'/Content/',name:'911f3d3b-6fc9-4bc2-984a-15c399b967bc.wepmt',size:436},{url:'/Content/940bd66d-a00e-43ef-9321-a637338f3064.wepfx',path:'/Content/',name:'940bd66d-a00e-43ef-9321-a637338f3064.wepfx',size:51273},{url:'/Content/9650a7a3-946d-4594-b0aa-a76083439cf7.wepmt',path:'/Content/',name:'9650a7a3-946d-4594-b0aa-a76083439cf7.wepmt',size:2743},{url:'/Content/9c2b33cf-b0de-42cd-b541-cc029ba807bd.wepsp',path:'/Content/',name:'9c2b33cf-b0de-42cd-b541-cc029ba807bd.wepsp',size:134},{url:'/Content/9f8ca319-e575-473b-b3cc-fd5864ed76c2.wepmt',path:'/Content/',name:'9f8ca319-e575-473b-b3cc-fd5864ed76c2.wepmt',size:2743},{url:'/Content/a3517b1a-80f5-4c3b-856f-9f8770a5b2d5.wepfx',path:'/Content/',name:'a3517b1a-80f5-4c3b-856f-9f8770a5b2d5.wepfx',size:2802},{url:'/Content/a428140a-25eb-4749-9ae9-4ebd760013b1.wepmt',path:'/Content/',name:'a428140a-25eb-4749-9ae9-4ebd760013b1.wepmt',size:2743},{url:'/Content/a7407d37-6b12-4279-a9da-1e0fcfda4ee2.wepfx',path:'/Content/',name:'a7407d37-6b12-4279-a9da-1e0fcfda4ee2.wepfx',size:17903},{url:'/Content/acfbdffa-97a3-42f3-b1dd-7be49272ad60.wepfx',path:'/Content/',name:'acfbdffa-97a3-42f3-b1dd-7be49272ad60.wepfx',size:11454},{url:'/Content/af8fa83e-af62-42f2-9f59-309a6e1cebdb.wepmt',path:'/Content/',name:'af8fa83e-af62-42f2-9f59-309a6e1cebdb.wepmt',size:2743},{url:'/Content/b4ad4d0f-7de3-4155-bcb4-7d684b2496cc.wepmt',path:'/Content/',name:'b4ad4d0f-7de3-4155-bcb4-7d684b2496cc.wepmt',size:2743},{url:'/Content/bd200973-e182-4db1-bd76-2e29a3e3ca95.wepmt',path:'/Content/',name:'bd200973-e182-4db1-bd76-2e29a3e3ca95.wepmt',size:2743},{url:'/Content/c0711965-7c9e-4026-a842-fedc49b577a6.wepmt',path:'/Content/',name:'c0711965-7c9e-4026-a842-fedc49b577a6.wepmt',size:2743},{url:'/Content/c17eca8b-504c-4080-af1e-65b4003eb9ef.wepmt',path:'/Content/',name:'c17eca8b-504c-4080-af1e-65b4003eb9ef.wepmt',size:2743},{url:'/Content/cache.yaml',path:'/Content/',name:'cache.yaml',size:9072},{url:'/Content/d1322288-d9e9-4b1e-b2fe-ca281f0388a2.wepft',path:'/Content/',name:'d1322288-d9e9-4b1e-b2fe-ca281f0388a2.wepft',size:135138},{url:'/Content/d2f8c39e-f58f-41fd-91c8-bb8f98478cca.wepsp',path:'/Content/',name:'d2f8c39e-f58f-41fd-91c8-bb8f98478cca.wepsp',size:134},{url:'/Content/d3b2306c-f515-47ed-8f8a-70526c148546.wepmt',path:'/Content/',name:'d3b2306c-f515-47ed-8f8a-70526c148546.wepmt',size:2743},{url:'/Content/d551eb2b-202d-454d-a059-c3ddce284636.wepfx',path:'/Content/',name:'d551eb2b-202d-454d-a059-c3ddce284636.wepfx',size:17420},{url:'/Content/d6294fcb-c64d-413e-8270-ff771b955b06.wepfx',path:'/Content/',name:'d6294fcb-c64d-413e-8270-ff771b955b06.wepfx',size:13725},{url:'/Content/d672019c-2887-4056-a0e7-2141d2fe5f78.wepfx',path:'/Content/',name:'d672019c-2887-4056-a0e7-2141d2fe5f78.wepfx',size:2735},{url:'/Content/d68b16ac-1b98-4b1a-95f6-eb39a41b70ec.wepfx',path:'/Content/',name:'d68b16ac-1b98-4b1a-95f6-eb39a41b70ec.wepfx',size:21451},{url:'/Content/d6998af7-e0e3-4256-9848-127320681137.wepmd',path:'/Content/',name:'d6998af7-e0e3-4256-9848-127320681137.wepmd',size:49083},{url:'/Content/d81d459c-c433-4ee3-bfe5-b45fbce12736.weptx',path:'/Content/',name:'d81d459c-c433-4ee3-bfe5-b45fbce12736.weptx',size:65776},{url:'/Content/d8cafa87-2b42-4176-9126-caac53f1257a.weprl',path:'/Content/',name:'d8cafa87-2b42-4176-9126-caac53f1257a.weprl',size:409},{url:'/Content/da9e0221-f777-4e5a-96c2-df012f2d7bf2.weprl',path:'/Content/',name:'da9e0221-f777-4e5a-96c2-df012f2d7bf2.weprl',size:409},{url:'/Content/daa1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',path:'/Content/',name:'daa1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',size:205790},{url:'/Content/db56f9d3-b4b9-46b5-a378-c237203c0734.wepfx',path:'/Content/',name:'db56f9d3-b4b9-46b5-a378-c237203c0734.wepfx',size:4785},{url:'/Content/dbb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',path:'/Content/',name:'dbb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',size:22870},{url:'/Content/dcb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',path:'/Content/',name:'dcb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',size:5060},{url:'/Content/dd86a555-371c-4c72-8cf3-c32d5219af74.wepfx',path:'/Content/',name:'dd86a555-371c-4c72-8cf3-c32d5219af74.wepfx',size:10630},{url:'/Content/ddb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',path:'/Content/',name:'ddb1f60a-82ad-40fc-8fbb-7b85caa6de0a.wepfx',size:18061},{url:'/Content/ddf0eb32-014e-4fdf-afb4-2175693c3c35.wepmd',path:'/Content/',name:'ddf0eb32-014e-4fdf-afb4-2175693c3c35.wepmd',size:71695},{url:'/Content/de86d0db-698b-4250-96ab-377d2baf978a.wepmd',path:'/Content/',name:'de86d0db-698b-4250-96ab-377d2baf978a.wepmd',size:38495},{url:'/Content/dfb5efbf-33e9-4b56-836d-cb8ca4ca0c80.wepfx',path:'/Content/',name:'dfb5efbf-33e9-4b56-836d-cb8ca4ca0c80.wepfx',size:5089},{url:'/Content/e350cce9-26c9-482c-acdc-2568c94c4321.wepmd',path:'/Content/',name:'e350cce9-26c9-482c-acdc-2568c94c4321.wepmd',size:32513},{url:'/Content/e35c59a9-26ab-4b4c-8210-4b1f21c31530.weprl',path:'/Content/',name:'e35c59a9-26ab-4b4c-8210-4b1f21c31530.weprl',size:409},{url:'/Content/e6f51776-1e8e-449d-8fc4-c0a3a4e4de5c.wepfx',path:'/Content/',name:'e6f51776-1e8e-449d-8fc4-c0a3a4e4de5c.wepfx',size:12670},{url:'/Content/e9686590-6716-4399-ad49-c1617e691dd4.wepmt',path:'/Content/',name:'e9686590-6716-4399-ad49-c1617e691dd4.wepmt',size:2743},{url:'/Content/ea533959-cf23-457d-9bcc-a85ff04e2c36.wepmt',path:'/Content/',name:'ea533959-cf23-457d-9bcc-a85ff04e2c36.wepmt',size:2743},{url:'/Content/ec2930c2-d4d7-4b74-807c-831c135d02e0.wepsp',path:'/Content/',name:'ec2930c2-d4d7-4b74-807c-831c135d02e0.wepsp',size:134}];
// This variable will be written by PreloadContent target
// var assets = [{ url: "assets/file.txt", path: "assets", name: "file.txt" }];

var timeout_ms = 5 * 1000;

var evergineAssetsInitilized = false;
var assetsLength = assets.length;
var progressSum = 0;
var assetsProgress = new Object();
var assetsLoaded = 0;
var fileSystem = undefined;

// This is the promise code, so this is the useful bit
function ensureFilesystemIsSet(timeout) {
  var start = Date.now();
  return new Promise(waitForFS); // set the promise object within the ensureFilesystemIsSet object

  // waitForFS makes the decision whether the condition is met
  // or not met or the timeout has been exceeded which means
  // this promise will be rejected
  function waitForFS(resolve, reject) {
    fileSystem = Module.FS || window.FS;
    if (fileSystem) resolve(fileSystem);
    else if (timeout && Date.now() - start >= timeout)
      reject(new Error("timeout"));
    else setTimeout(waitForFS.bind(this, resolve, reject), 30);
  }
}

function loadAsset(asset) {
  assetsProgress[asset.url] = 0;

  let xhr = new XMLHttpRequest();
  xhr.open("GET", asset.url, true);
  xhr.responseType = "blob";
  xhr.onprogress = function (event) {
    let contentLength;
    if (event.lengthComputable) {
      contentLength = event.total;
    } else {
      contentLength = asset.size; // original size
    }
    progressSum -= assetsProgress[asset.url];
    assetsProgress[asset.url] = event.loaded / contentLength;
    progressSum += assetsProgress[asset.url];
    if (Module["setProgress"])
      Module["setProgress"]((progressSum / assetsLength) * 100);
    if (window.evergineSetProgressCallback)
      window.evergineSetProgressCallback((progressSum / assetsLength) * 100);
  };
  xhr.onerror = function (event) {
    throw new Error("NetworkError for: " + packageName);
  };
  xhr.onload = function (event) {
    if (
      xhr.status == 200 ||
      xhr.status == 304 ||
      xhr.status == 206 ||
      (xhr.status == 0 && xhr.response)
    ) {
      // file URLs can return 0
      var packageData = xhr.response;
      packageData
        .arrayBuffer()
        .then((data) => saveFile(asset.path, asset.name, data));
    } else {
      throw new Error(xhr.statusText + " : " + xhr.responseURL);
    }
  };
  xhr.send(null);
}

function saveFile(parentDirectory, fileName, data) {
  let bytes = new Uint8Array(data);

  fileSystem.createPath("/", parentDirectory, true, true);

  let fileRet = fileSystem.createDataFile(
      parentDirectory,
      fileName,
      bytes,
      true,
      true,
      true
  );
  assetsLoaded += 1;
  if (areAllAssetsLoaded()) {
    console.log(`...FS completed.`);
  }
}

function areAllAssetsLoaded() {
  if (!evergineAssetsInitilized) {
      initializeEvergineAssets();
  }
  return assetsLength == assetsLoaded;
}

// Hack for random dotnet failure when creating files
window.HEAP8 = {
  buffer: 0,
};

// This runs the promise code
function initializeEvergineAssets() {
  evergineAssetsInitilized = true;
  ensureFilesystemIsSet(timeout_ms)
    .then(() => {
      console.log(`Loading ${assets.length} files to FS...`);
      assets.forEach((asset) => loadAsset(asset));
    })
    .catch((e) => {
      console.log(e);
    });
}